<script type="text/javascript" src="#springUrl('')/static/js/bootstrap-tooltip.js"></script>
<script type="text/javascript" src="#springUrl('')/static/js/bootstrap-confirmation.js"></script>

 <script  type="text/javascript">
	var parameters = [];
	var skuJson = "";
	$(function () {  
		//上部全选 
		$("#reverseAllT").click(function () {  
        	$('input[name="productchk"]:checkbox').each(function () {
        		$(this).attr("checked", !$(this).attr("checked"));  
            });  
			$('#reverseAllB').attr("checked", !$('#reverseAllB').attr("checked"));  
        });  
		//下部全选
		$("#reverseAllB").click(function () {  
        	$('input[name="productchk"]:checkbox').each(function () {
        		$(this).attr("checked", !$(this).attr("checked"));  
            });  
			$('#reverseAllT').attr("checked", !$('#reverseAllT').attr("checked"));  
        });
    }); 
	
	//提交当前选中商品去结算
	function goSettlement(){
		$('input[name="productchk"]:checked').each(function () {
			var _value = $(this).val();
			var valueArray = _value.split('|');
			//alert(valueArray[0]);alert(valueArray[1]);
			skuJson = "{\"skuNo\":" + "\"" + valueArray[0] + "\","  + "\"skuCount\":" + valueArray[1] +"}";
			parameters.push(JSON.parse(skuJson));
		});
		$("#parameters").val(JSON.stringify(parameters));
		//alert($("#parameters").val());
		$("#cartForm").attr("action", "#springUrl('')/orderinfo/info");
        $("#cartForm").attr("method", "POST");
        $("#cartForm").submit();
	}
	function deleteProduct(skuNo){
		jQuery.ajax({ 
            type:"POST", 
            url:"#springUrl('')/cart/deleteCart", 
            dataType:"json",      
            data:"skuNo="+skuNo,
            success:function(data){ 
				alert("删除成功");
            } 
         }); 
	}
	
	function upper(skuNo){
		var currentSkuCount = $("#C-"+skuNo).val();
		currentSkuCount ++;
		//alert(skuNo);alert(currentSkuCount);
		jQuery.ajax({ 
            type:"POST", 
            url:"#springUrl('')/cart/updateCart", 
            dataType:"json",      
            data:"skuNo="+skuNo+"&skuCount="+currentSkuCount,
            success:function(data){ 
				$("#C-"+skuNo).val(currentSkuCount);
            } 
         }); 
	}
	function lower(skuNo){
		var currentSkuCount = $("#C-"+skuNo).val();
		currentSkuCount --;
		jQuery.ajax({ 
            type:"POST", 
            url:"#springUrl('')/cart/updateCart", 
            dataType:"json",      
            data:"skuNo="+skuNo+"&skuCount="+currentSkuCount,
            success:function(data){ 
				$("#C-"+skuNo).val(currentSkuCount);
            } 
         }); 
	}
</script>

<!---------------------- 我的购物车  ----------------------> 
    </script>
      <div class="container wid1200 clearfix">
         <div class="clearfix">
           <div class="step1 right"></div>
         </div> 
         <div class="clearfix">
           <h3 class="my_cat_con ml10">我的购物车</h3>
           <table width="100%" border="0" class="cat_tab" cellspacing="0" cellpadding="0">
           <thead>
              <tr>
                <th class="tcenter" width="75"><input type="checkbox" id="reverseAllT"/></th>
                <th width="193">全选</th>
                <th width="247">商品</th>
                <th width="200">价格</th>
                <th class="tcenter">数量</th>
                <th class="tcenter" width="129">操作</th>
              </tr>
              </thead>
                  <tbody>
    			 #foreach( $item in $dataList)
                      <tr>
                        <td class="tcenter"><input type="checkbox" name="productchk" value="$!item.skuNo|$!item.skuCount"/></td>
                        <td><a href="#springUrl('')/shopping/product_details?skuNo='$!skuNo'" ><img class="my_cat_img" src="#springUrl('')/static/images/m-img2.jpg" /></a></td>
                        <td><p>$!item.skuName</p></td>
                        <td>¥$!item.price</td>
                        <td class="tcenter"><div class="buynum"><a href="#" class="reduce ml20" onclick="lower('$!item.skuNo');">-</a><input type="text" id="C-$!item.skuNo" value="$!item.skuCount"/><a href="#" class="reduce"  onclick="upper('$!item.skuNo');">+</a></div></td>
                        <td class="tcenter"><a href="#" class="del" onclick="javascript:deleteProduct('$!item.skuNo');">删除</a><a href="" class="modify">修改</a></td>
                      </tr>
    			  #end
                  </tbody>
              <tfoot>
              <tr>
                <td class="white tcenter"><input type="checkbox" id="reverseAllB"/></td>
                <td class="white">全选</td>
                <td class="white" colspan="4"><div class="right total">共计：<span class="reds">2</span>件商品</div></td>
                </tr>
            </tfoot>
		   </table>
           <div class="settlement">
             <div class="right"><a href="#" class="right" onclick="javascript:goSettlement();">去结算<i></i></a>费用：<span class="reds">712元</span></div>
           </div>
         </div> 
       <form id="cartForm">
			<input type="hidden" id="parameters" name="parameters"/>
       </form>
      </div>  
    
 <!---------------------- 正文end ----------------------> 
 